<mvc:View controllerName="com.sap.equipmaintproject.controller.Home"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:ch="sap.suite.ui.commons"
    xmlns:viz="sap.viz.ui5.controls"
    xmlns:viz.feeds="sap.viz.ui5.controls.common.feeds"
    xmlns:viz.data="sap.viz.ui5.data"
    xmlns:layout="sap.ui.layout"
    xmlns:fb="sap.ui.comp.filterbar"
    displayBlock="true">
    
    <Page id="page" title="{i18n>title}">
        <f:DynamicPage id="DP01" headerExpanded="{/headerExpanded}">
            <f:header>
                <f:DynamicPageHeader id="DPH01">
                    <f:content>
                        <fb:FilterBar id="filterbar" persistencyKey="myPersKey" useToolbar="false" showGoOnFB="false" showFilterConfiguration="false" advancedMode="false">
                            <fb:filterGroupItems>
                                <fb:FilterGroupItem id="FGI01" name="plantID" label="Plant" groupName="Group1" visibleInFilterBar="true">
                                    <fb:control>
                                        <MultiComboBox id="MCB01"
                                                    name="plantID"
                                                    selectionChange=".onSelectionChange"
                                                    items="{path: 'mainModel>/EquipMaint', length: 5}">
                                            <core:Item id="I01" key="{mainModel>plantID}" text="{mainModel>plantID}"/>
                                        </MultiComboBox>
                                    </fb:control>
                                </fb:FilterGroupItem>
                                <fb:FilterGroupItem id="FGI02" name="ServiceDateID" label="Service Date" groupName="Group1" visibleInFilterBar="true" >
                                    <fb:control>
                                        <MultiComboBox id="MCB02"
                                            name="ServiceDateID"
                                            selectionChange=".onSelectionChange"
                                            items="{path: 'mainModel>/EquipMaint', length: 159}">
                                            <core:Item id="I02" key="{mainModel>serviceDateID}" text="{mainModel>serviceDateID}"/>
                                        </MultiComboBox>
                                    </fb:control>
                                </fb:FilterGroupItem>
                                <fb:FilterGroupItem id="FGI03" name="MachineIDID" label="Machine ID" groupName="Group1" visibleInFilterBar="true">
                                    <fb:control>
                                        <MultiComboBox id="MCB03"
                                            name="MachineIDID"
                                            selectionChange=".onSelectionChange"
                                            items="{path: 'mainModel>/EquipMaint', length: 23}">
                                            <core:Item id="I03" key="{mainModel>machineIDID}" text="{mainModel>machineIDID}"/>
                                        </MultiComboBox>
                                    </fb:control>
                                </fb:FilterGroupItem>
                            </fb:filterGroupItems>
                            <Button id="goButton" text="Search" press=".doFiltering"/>
                        </fb:FilterBar>
                    </f:content>           
                </f:DynamicPageHeader>                                        
            </f:header>             
            <f:content>
                <VBox id="_IDGenVBox1">   
                    <VBox id="_IDGenHBox2">
                        <HBox id="_IDGenHBox3">
                            <VBox id="_IDGenVBox01" width="35%">
                                <layout:FixFlex id='chartFixFlex' minFlexSize="250">
                                    <layout:flexContent>
                                        <viz:VizFrame id="idVizFrame1" uiConfig="{applicationSet:'fiori'}"
                                                    height="400px" width="100%" vizType="stacked_bar" 
                                                    vizProperties="{ title: {text : 'Service Count by Maintenance Type and Month/Year', visible : true}}">
                                            <viz:dataset>
                                                <viz.data:FlattenedDataset id="_IDGenFlattenedDataset1" data="{path: 'mainModel>/AggregatedEquipMaint_C1'}">
                                                    <viz.data:dimensions>
                                                        <viz.data:DimensionDefinition id="_IDGenDimensionDefinition1" name="Month"
                                                                                    value="{mainModel>month}" />
                                                        <viz.data:DimensionDefinition id="_IDGenDimensionDefinition02" name="Year"
                                                                                    value="{mainModel>year}" />
                                                        <viz.data:DimensionDefinition id="_IDGenDimensionDefinition03" name="Maintenance Type"
                                                                                    value="{mainModel>maintenanceType}" />
                                                    </viz.data:dimensions>
                                                    <viz.data:measures>
                                                        <viz.data:MeasureDefinition id="_IDGenMeasureDefinition1" name="Service Count"
                                                                                    value="{mainModel>totalserviceCount}" /> <!-- Each record counts as 1 service event -->
                                                    </viz.data:measures>
                                                </viz.data:FlattenedDataset>
                                            </viz:dataset>
                                            <viz:feeds>
                                                <viz.feeds:FeedItem id='valueAxisFeed1' uid="valueAxis" type="Measure" values="Service Count" />
                                                <viz.feeds:FeedItem id='categoryAxisFeed1' uid="categoryAxis" type="Dimension" values="Month" />
                                                <viz.feeds:FeedItem id='categoryAxisFeed02' uid="categoryAxis" type="Dimension" values="Year" />
                                                <viz.feeds:FeedItem id='categoryAxisFeed03' uid="categoryAxis" type="Dimension" values="Maintenance Type" />
                                            </viz:feeds>
                                            <viz:dependents>
                                                <viz:Popover id="idPopOver1"></viz:Popover>
                                            </viz:dependents>
                                        </viz:VizFrame>
                                    </layout:flexContent>
                                </layout:FixFlex>
                            </VBox>
                            <VBox id="_IDGenVBox02" width="65%">
                                <layout:FixFlex id='chartFixFlex2' minFlexSize="250">
                                    <layout:flexContent>
                                        <viz:VizFrame id="idVizFrame2" uiConfig="{applicationSet:'fiori'}"
                                            height='400px' width="100%" vizType='stacked_bar' vizProperties="{ title: {text : 'Service Cost by Maintenance Location and Machine Description', visible : true}}">
                                            <viz:dataset>
                                                <viz.data:FlattenedDataset id="_IDGenFlattenedDataset2" data="{mainModel>/AggregatedEquipMaint_C2}">
                                                    <viz.data:dimensions>
                                                        <viz.data:DimensionDefinition id="_IDGenDimensionDefinition2" name="Machine Description" value="{mainModel>machineDescription}" />
                                                        <viz.data:DimensionDefinition id="_IDGenDimensionDefinition3" name="Maintenance Location" value="{mainModel>maintenanceLocation}" />
                                                    </viz.data:dimensions>
                                                    <viz.data:measures>
                                                        <viz.data:MeasureDefinition id="_IDGenMeasureDefinition3" name="Labor Cost" value="{mainModel>totalLaborCost}" />
                                                    </viz.data:measures>
                                                </viz.data:FlattenedDataset>
                                            </viz:dataset>
                                            <viz:feeds>
                                                <viz.feeds:FeedItem id='valueAxisFeed3' uid="valueAxis" type="Measure" values="Labor Cost" />
                                                <viz.feeds:FeedItem id='categoryAxisFeed2' uid="categoryAxis" type="Dimension" values="Machine Description" />
                                                <viz.feeds:FeedItem id='categoryAxisFeed3' uid="categoryAxis" type="Dimension" values="Maintenance Location" />
                                            </viz:feeds>
                                            <viz:dependents>
                                                <viz:Popover id="idPopOver2"></viz:Popover>
                                            </viz:dependents>
                                        </viz:VizFrame>
                                    </layout:flexContent>
                                </layout:FixFlex>
                            </VBox>
                        </HBox>
                    </VBox>           
                    <VBox id="_IDGenVBox2">
                        <Table items="{mainModel>/EquipMaint}" id="table0" mode="None" selectionChange="onSelect">
                            <columns>
                                <Column id="_IDGenColumn1" minScreenWidth="Tablet" demandPopin="true" width="75px">
                                    <Text id="_IDGenText1" text="Maintenance ID" />
                                </Column>
                                <Column id="_IDGenColumn2" minScreenWidth="Tablet" demandPopin="true" width="60px">
                                    <Text id="_IDGenText2" text="Machine ID" />
                                </Column>
                                <Column id="_IDGenColumn3" minScreenWidth="Tablet" demandPopin="true" width="90px">
                                    <Text id="_IDGenText3" text="Machine Description" />
                                </Column>
                                <Column id="_IDGenColumn4" minScreenWidth="Tablet" demandPopin="true" width="80px">
                                    <Text id="_IDGenText4" text="Maintenance Location" />
                                </Column>
                                <Column id="_IDGenColumn5" minScreenWidth="Tablet" demandPopin="true" width="55px">
                                    <Text id="_IDGenText5" text="Service Date" />
                                </Column>
                                <Column id="_IDGenColumn6" minScreenWidth="Tablet" demandPopin="true" width="70px">
                                    <Text id="_IDGenText6" text="Technician" />
                                </Column>
                                <Column id="_IDGenColumn7" minScreenWidth="Tablet" demandPopin="true" width="80px">
                                    <Text id="_IDGenText7" text="Maintenance Type" />
                                </Column>
                                <Column id="_IDGenColumn8" minScreenWidth="Tablet" demandPopin="true" width="285px">
                                    <Text id="_IDGenText8" text="Technician Comments" />
                                </Column>
                                <Column id="_IDGenColumn9" minScreenWidth="Tablet" demandPopin="true" width="55px">
                                    <Text id="_IDGenText9" text="Plant" />
                                </Column>
                                <Column id="_IDGenColumn10" minScreenWidth="Tablet" demandPopin="true" width="70px">
                                    <Text id="_IDGenText10" text="Plant Description" />
                                </Column>
                                <Column id="_IDGenColumn11" minScreenWidth="Tablet" demandPopin="true" width="50px">
                                    <Text id="_IDGenText11" text="Labor Cost" />
                                </Column>
                                <Column id="_IDGenColumn12" minScreenWidth="Tablet" demandPopin="true" width="75px">
                                    <Text id="_IDGenText12" text="Spare Parts Cost" />
                                </Column>
                                <Column id="_IDGenColumn13" minScreenWidth="Tablet" demandPopin="true" width="60px">
                                    <Text id="_IDGenText13" text="Currency Type" />
                                </Column>
                            </columns>
                            <items>
                                <ColumnListItem type="Active" id="item0">
                                    <cells>
                                        <Text id="id1" text="{mainModel>maintID}" />
                                        <Text id="id2" text="{mainModel>machineID}" />
                                        <Text id="id3" text="{mainModel>machineDescription}" />
                                        <Text id="id4" text="{mainModel>maintenanceLocation}" />
                                        <Text id="id5" text="{mainModel>serviceDate}" />
                                        <Text id="id6" text="{mainModel>technician}" />
                                        <Text id="id7" text="{mainModel>maintenanceType}" />
                                        <Text id="id8" text="{mainModel>technicianComments}" />
                                        <Text id="id9" text="{mainModel>plant}" />
                                        <Text id="id10" text="{mainModel>plantDescription}" />
                                        <Text id="id11" text="{mainModel>laborCost}" />
                                        <Text id="id12" text="{mainModel>sparePartsCost}" />
                                        <Text id="id13" text="{mainModel>currencyType}" />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </VBox>
                </VBox>
            </f:content>
        </f:DynamicPage>
    </Page>
</mvc:View>
